<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="my-doc_listeoperation">
		  <template>
			  <style>
				
				.databrutes { color:grey;white-space: pre;width:500px; font-family: monospace; font-size: 10px;}
			  	
			  	.cadre {
		        	display :block;
		            margin: 5px;
		            padding:5px;
		          	position: relative;
		            background-color: white;
			        box-shadow: 1px 1px 1px 1px;
			        border-radius: 3px;
			     }
			  	.facture{
			  		color:green;
			  	}
			  	.titre{
			  		color:black;
					font-size: 14px;
					text-align: center;
				}
				.sejour{
					color:red;
					margin-left:10px
				}
				.famille{
					color:blue;
					margin-left:20px;
				}
			  </style>
			  
			 <iron-ajax
				id="charge_operation"			    method="GET"
			    url="{{charge_operation_url}}"	    headers="{{app.header_auth}}"
			    params="{{params_get_operation}}"    handle-as="json"   	on-error="_disconnect"
			    last-response="{{operation}}"   		debounce-duration="300">
			</iron-ajax>
			
			<div class="cadre">
				  <p class="titre">
					<b>Régie de recette avec cautions</b>
					</br>	
					<b>du {{occupation_sel.date_deb}} au {{occupation_sel.date_fin}}</b>
				  </p>					 
		  	 </div>
			 <div>
			 <h2>[[aire_sel.nom]]</h2>
			 </div>
			<table>
			
			<thead>
			   <tr>
			       <th>Date</th>
			       <th>Opération</th>
			       <th>Montant</th>
			       <th>Numéros</th>
			       <th>Usager</th>
			   </tr>			
			</thead>		
			<tbody>
				<template is="dom-repeat" items="[[operation]]" as="lig">
				   <tr>
				       
				       <td>[[lig.date]]</td>
				       <td>[[lig.type_operation]]</td>
				       <td>[[lig.montant]]</td>
				       <td>[[lig.recu_num]]</td>
				       <td>[[personne.Nom]] [[personne.prenom]]</td>
				   </tr>
			   	</template>						
			</tbody>
			</table>
				
		  </template>
		
		  <script>
		    Polymer({
		
		      is: 'my-doc_listeoperation',

		      properties: {
		 	     app: {
			          type: Object
		        	},    
		    	 selection_query:{type : Object,
	  				  notify:true,
	  				  value:{}},
		  		 params_get_operation:{type: Object,
			   	 	  notify : true,
			   	 	  value: {type:'get',action:'listcompte_ecriture'}},
		      },
	    	  observers: [
		                  '_selection_query_change(selection_query)'	                  
		                ],
		      
		      _selection_query_change: function(selection_query) {
			        this.app = document.querySelector('#app');
			        if (this.params_get_operation && selection_query && selection_query.date1 && selection_query.date2) {
			        	this.params_get_operation.date=" between '"+selection_query.date1+"' and '"+selection_query.date2+"'";
			        } else if (this.params_get_operation && selection_query && selection_query.date1) {
			        	this.params_get_operation.date=">='"+selection_query.date1+"'";
			        } else if (this.params_get_operation && selection_query && selection_query.date2) {
			        	this.params_get_operation.date="<='"+selection_query.date2+"'";
			        } else if (this.params_get_operation) {
			        	this.params_get_operation.date='';
			        }
			        
			        this.charge_operation_url=this.app.url_api+':'+this.app.port_api+'/index'
			    	this.$.charge_operation.generateRequest();
			  },
			  
			  
			  
			  _disconnect: function(obj){
		    	  this.app = document.querySelector('#app');
		    	  return this.app.disconnect();
		      }
		    });
		  </script>
		</dom-module>